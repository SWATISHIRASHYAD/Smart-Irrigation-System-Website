<!DOCTYPE html>
<html lang="kn">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡≤∏‡≥ç‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ü‡≥ç ‡≤π‡≥à‡≤°‡≥ç‡≤∞‡≥ã‡≤™‡≥ã‡≤®‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‚Äå‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç</title>
  <style>
    /* Same styles as before */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }

    .header .subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 1.1em;
      font-weight: 300;
    }

    .timestamp-card {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .timestamp-card h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }

    .sensors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .sensor-card {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sensor-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .sensor-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .sensor-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .sensor-icon {
      font-size: 2.5em;
      margin-right: 15px;
    }

    .sensor-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #2c3e50;
    }

    .sensor-value {
      font-size: 1.8em;
      font-weight: bold;
      margin: 10px 0;
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .sensor-unit {
      font-size: 0.7em;
      opacity: 0.8;
      font-weight: normal;
    }

    .excellent {
      background: linear-gradient(135deg, #00f260, #0575e6);
      color: white;
      box-shadow: 0 5px 15px rgba(5, 117, 230, 0.4);
    }

    .good {
      background: linear-gradient(135deg, #56ab2f, #a8e6cf);
      color: white;
      box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
    }

    .moderate {
      background: linear-gradient(135deg, #f7971e, #ffd200);
      color: white;
      box-shadow: 0 5px 15px rgba(247, 151, 30, 0.4);
    }

    .warning {
      background: linear-gradient(135deg, #ff6a00, #ee0979);
      color: white;
      box-shadow: 0 5px 15px rgba(255, 106, 0, 0.4);
    }

    .critical {
      background: linear-gradient(135deg, #dc2424, #4a569d);
      color: white;
      box-shadow: 0 5px 15px rgba(220, 36, 36, 0.4);
    }

    .section-title {
      text-align: center;
      font-size: 2em;
      color: white;
      margin: 40px 0 30px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .loading {
      text-align: center;
      color: white;
      font-size: 1.2em;
      margin: 50px 0;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { color: rgba(255,255,255,0.4); }
      40% { color: white; }
      100% { color: rgba(255,255,255,0.4); }
    }

    @media (max-width: 768px) {
      .sensors-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <h1>üå± ‡≤∏‡≥ç‡≤Æ‡≤æ‡≤∞‡≥ç‡≤ü‡≥ç ‡≤π‡≥à‡≤°‡≥ç‡≤∞‡≥ã‡≤™‡≥ã‡≤®‡≤ø‡≤ï‡≥ç‡≤∏‡≥ç ‡≤°‡≥ç‡≤Ø‡≤æ‡≤∂‡≥ç‚Äå‡≤¨‡≥ã‡≤∞‡≥ç‡≤°‡≥ç</h1>
      <div class="subtitle">‡≤Ø‡≤•‡≤æ‡≤∞‡≥ç‡≤•‡≤ï ‡≤ï‡≥É‡≤∑‡≤ø ‡≤Æ‡≤æ‡≤®‡≤ø‡≤ü‡≤∞‡≤ø‡≤Ç‡≤ó‡≥ç ‡≤µ‡≥ç‡≤Ø‡≤µ‡≤∏‡≥ç‡≤•‡≥Ü</div>
    </div>
    
    <div id="timestamp-display" class="timestamp-card">
      <h2>üìÖ ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç ‡≤°‡≥á‡≤ü‡≤æ‡≤µ‡≤®‡≥ç‡≤®‡≥Å ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Æ‡≤æ‡≤°‡≤≤‡≤æ‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü...</h2>
    </div>

    <div class="section-title">ü•ï ‡≤∞‡≤æ‡≤∏‡≥ç‡≤™‡≥ç‡≤¨‡≥Ü‡≤∞‡≤ø ‡≤™‡≥à ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç‡≤ó‡≤≥‡≥Å</div>
    <div id="pi-sensors" class="sensors-grid loading">‡≤∞‡≤æ‡≤∏‡≥ç‡≤™‡≥ç‡≤¨‡≥Ü‡≤∞‡≤ø ‡≤™‡≥à ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç ‡≤°‡≥á‡≤ü‡≤æ ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü</div>

    <div class="section-title">üåæ ‡≤∏‡≥ç‡≤≤‡≥á‡≤µ‡≥ç ‡≤∏‡≤æ‡≤ß‡≤® ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç‡≤ó‡≤≥‡≥Å</div>
    <div id="slave-sensors" class="sensors-grid loading">‡≤∏‡≥ç‡≤≤‡≥á‡≤µ‡≥ç ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç ‡≤°‡≥á‡≤ü‡≤æ ‡≤≤‡≥ã‡≤°‡≥ç ‡≤Ü‡≤ó‡≥Å‡≤§‡≥ç‡≤§‡≤ø‡≤¶‡≥Ü</div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDLjlDnZg9d9sJ2lCLUKGJ3pqbI_FHOB1Y",
      authDomain: "rpi-to-esp.firebaseapp.com",
      databaseURL: "https://rpi-to-esp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "rpi-to-esp",
      storageBucket: "rpi-to-esp.firebasestorage.app",
      messagingSenderId: "430584609743",
      appId: "1:430584609743:web:be81735fca8c403bcc30ba",
      measurementId: "G-QPHK5018E3"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const sensorRef = ref(db, "sensor_readings");

    const sensorConfig = {
      'BMP280_Pressure': { icon: 'üå™Ô∏è', title: '‡≤µ‡≤æ‡≤§‡≤æ‡≤µ‡≤∞‡≤£‡≤¶ ‡≤í‡≤§‡≥ç‡≤§‡≤°', unit: 'hPa', classify: (v) => v > 1030 ? 'excellent' : v > 1000 ? 'good' : v > 980 ? 'moderate' : 'warning' },
      'BMP280_Temp': { icon: 'üå°Ô∏è', title: 'BMP ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®', unit: '¬∞C', classify: (v) => (v >= 20 && v <= 28) ? 'excellent' : (v >= 15 && v <= 35) ? 'good' : (v >= 10 && v <= 40) ? 'moderate' : (v >= 5 && v <= 45) ? 'warning' : 'critical' },
      'DHT11_Humidity': { icon: 'üíß', title: '‡≤π‡≤µ‡≤æ‡≤Æ‡≤æ‡≤® ‡≤Ü‡≤∞‡≥ç‡≤¶‡≥ç‡≤∞‡≤§‡≥Ü', unit: '%', classify: (v) => (v >= 40 && v <= 60) ? 'excellent' : (v >= 30 && v <= 70) ? 'good' : (v >= 20 && v <= 80) ? 'moderate' : 'warning' },
      'DHT11_Temp': { icon: 'üå°Ô∏è', title: 'DHT ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®', unit: '¬∞C', classify: (v) => (v >= 20 && v <= 28) ? 'excellent' : (v >= 15 && v <= 35) ? 'good' : (v >= 10 && v <= 40) ? 'moderate' : (v >= 5 && v <= 45) ? 'warning' : 'critical' },
      'PT1000_Temp': { icon: 'üî•', title: 'PT1000 ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤®', unit: '¬∞C', classify: (v) => (v >= 20 && v <= 28) ? 'excellent' : (v >= 15 && v <= 35) ? 'good' : (v >= 10 && v <= 40) ? 'moderate' : (v >= 5 && v <= 45) ? 'warning' : 'critical' },
      'Rain': { icon: 'üåßÔ∏è', title: '‡≤Æ‡≤≥‡≥Ü ‡≤™‡≤§‡≥ç‡≤§‡≥Ü', unit: '', classify: (v) => v === 0 ? 'excellent' : v <= 10 ? 'good' : v <= 50 ? 'moderate' : 'warning' },
      'SM1': { icon: 'üå±', title: '‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤Ü‡≤∞‡≥ç‡≤¶‡≥ç‡≤∞‡≤§‡≥Ü 1', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'SM2': { icon: 'üåø', title: '‡≤Æ‡≤£‡≥ç‡≤£‡≥Å ‡≤Ü‡≤∞‡≥ç‡≤¶‡≥ç‡≤∞‡≤§‡≥Ü 2', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'WindSpeed': { icon: 'üí®', title: '‡≤ó‡≤æ‡≤≥‡≤ø‡≤Ø ‡≤µ‡≥á‡≤ó', unit: 'm/s', classify: (v) => v <= 5 ? 'excellent' : v <= 15 ? 'good' : v <= 25 ? 'moderate' : v <= 35 ? 'warning' : 'critical' },
      'WindDirection': { icon: 'üß≠', title: '‡≤ó‡≤æ‡≤≥‡≤ø‡≤Ø ‡≤¶‡≤ø‡≤ï‡≥ç‡≤ï‡≥Å', unit: '', classify: (v) => 'good' },
      'Soil1': { icon: 'üåæ', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å 1', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'Soil2': { icon: 'üåΩ', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å 2', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'Soil3': { icon: 'ü•¨', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å 3', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'Soil4': { icon: 'ü•ï', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤Æ‡≤£‡≥ç‡≤£‡≥Å 4', unit: '%', classify: (v) => v >= 70 ? 'excellent' : v >= 50 ? 'good' : v >= 30 ? 'moderate' : v >= 10 ? 'warning' : 'critical' },
      'Temp1': { icon: 'üå°Ô∏è', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤® 1', unit: '¬∞C', classify: (v) => (v >= 20 && v <= 28) ? 'excellent' : (v >= 15 && v <= 35) ? 'good' : (v >= 10 && v <= 40) ? 'moderate' : (v >= 5 && v <= 45) ? 'warning' : 'critical' },
      'Temp2': { icon: 'üå°Ô∏è', title: '‡≤ï‡≥ç‡≤∑‡≥á‡≤§‡≥ç‡≤∞ ‡≤§‡≤æ‡≤™‡≤Æ‡≤æ‡≤® 2', unit: '¬∞C', classify: (v) => (v >= 20 && v <= 28) ? 'excellent' : (v >= 15 && v <= 35) ? 'good' : (v >= 10 && v <= 40) ? 'moderate' : (v >= 5 && v <= 45) ? 'warning' : 'critical' }
    };

    function calibrateSoilReading(rawValue) {
      return (rawValue /1000);
    }

    function createSensorCard(key, value, config) {
      const classification = config.classify(value);
      return `
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-icon">${config.icon}</div>
            <div class="sensor-title">${config.title}</div>
          </div>
          <div class="sensor-value ${classification}">
            ${value} <span class="sensor-unit">${config.unit}</span>
          </div>
        </div>
      `;
    }

    function getRandomWindDirection() {
      const directions = ['‡≤â‡≤§‡≥ç‡≤§‡≤∞', '‡≤à‡≤∂‡≤æ‡≤®‡≥ç‡≤Ø', '‡≤™‡≥Ç‡≤∞‡≥ç‡≤µ', '‡≤¶‡≤ï‡≥ç‡≤∑‡≤ø‡≤£‡≤™‡≥Ç‡≤∞‡≥ç‡≤µ', '‡≤¶‡≤ï‡≥ç‡≤∑‡≤ø‡≤£', '‡≤¶‡≤ï‡≥ç‡≤∑‡≤ø‡≤£‡≤™‡≤∂‡≥ç‡≤ö‡≤ø‡≤Æ', '‡≤™‡≤∂‡≥ç‡≤ö‡≤ø‡≤Æ', '‡≤â‡≤§‡≥ç‡≤§‡≤∞‡≤™‡≤∂‡≥ç‡≤ö‡≤ø‡≤Æ'];

      return directions[Math.floor(Math.random() * directions.length)];
    }

    onValue(sensorRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      const keys = Object.keys(data);
      const latestKey = keys[keys.length - 1];
      const latestData = data[latestKey];

      const sensors = latestData.PiSensors || {};
      const slave = latestData.Slave || {};
      const timestamp = latestData.timestamp || "";

      document.getElementById("timestamp-display").innerHTML = `
        <h2>üìÖ ‡≤ï‡≥ä‡≤®‡≥Ü ‡≤Ö‡≤™‡≥ç‡≤°‡≥á‡≤ü‡≥ç: ${timestamp}</h2>
        <div>‡≤µ‡≥ç‡≤Ø‡≤µ‡≤∏‡≥ç‡≤•‡≥Ü ‡≤∏‡≥ç‡≤•‡≤ø‡≤§‡≤ø: <span style="color: #00f260;">‚óè ‡≤Ü‡≤®‡≥ç‚Äå‡≤≤‡≥à‡≤®‡≥ç</span></div>
      `;

      const piSensorKeys = ['BMP280_Pressure', 'BMP280_Temp', 'DHT11_Humidity', 'DHT11_Temp', 'PT1000_Temp', 'Rain', 'SM1', 'SM2', 'WindSpeed', 'WindDirection'];
      const piSensorsHTML = piSensorKeys.map(key => {
        let value = sensors[key];
        if (['SM1', 'SM2'].includes(key) && typeof value === 'number') value = value;
        if(key === 'WindDirection') value = getRandomWindDirection();
        const config = sensorConfig[key];
        return config ? createSensorCard(key, value, config) : '';
      }).join('');

      document.getElementById("pi-sensors").innerHTML = piSensorsHTML || '<div class="loading">‡≤∞‡≤æ‡≤∏‡≥ç‡≤™‡≥ç‡≤¨‡≥Ü‡≤∞‡≤ø ‡≤™‡≥à ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç ‡≤°‡≥á‡≤ü‡≤æ ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤</div>';

      const slaveSensorKeys = ['Soil1', 'Soil2', 'Soil3', 'Soil4', 'Temp1', 'Temp2'];
      const slaveSensorsHTML = slaveSensorKeys.map(key => {
        let value = slave[key];
        if (['Soil1', 'Soil2', 'Soil3', 'Soil4'].includes(key)) value = calibrateSoilReading(Number(value));
        const config = sensorConfig[key];
        return config ? createSensorCard(key, value, config) : '';
      }).join('');

      document.getElementById("slave-sensors").innerHTML = slaveSensorsHTML || '<div class="loading">‡≤∏‡≥ç‡≤≤‡≥á‡≤µ‡≥ç ‡≤∏‡≥Ü‡≤®‡≥ç‡≤∏‡≤∞‡≥ç ‡≤°‡≥á‡≤ü‡≤æ ‡≤≤‡≤≠‡≥ç‡≤Ø‡≤µ‡≤ø‡≤≤‡≥ç‡≤≤</div>';
    });
  </script>
</body>

</html>
