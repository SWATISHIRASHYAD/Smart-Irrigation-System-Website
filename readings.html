<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Irrigation Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 2.5em;
      color: white;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      margin-bottom: 10px;
    }

    .header .subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 1.1em;
      font-weight: 300;
    }

    .timestamp-card {
      background: linear-gradient(135deg, #2c3e50, #34495e);
      color: white;
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .timestamp-card h2 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }

    .sensors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .sensor-card {
      background: rgba(255,255,255,0.95);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .sensor-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }

    .sensor-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .sensor-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #f0f0f0;
    }

    .sensor-icon {
      font-size: 2.5em;
      margin-right: 15px;
    }

    .sensor-title {
      font-size: 1.3em;
      font-weight: 600;
      color: #2c3e50;
    }

    .sensor-value {
      font-size: 1.8em;
      font-weight: bold;
      margin: 10px 0;
      padding: 15px;
      border-radius: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }

    .sensor-unit {
      font-size: 0.7em;
      opacity: 0.8;
      font-weight: normal;
    }

    /* Status Colors */
    .excellent {
      background: linear-gradient(135deg, #00f260, #0575e6);
      color: white;
      box-shadow: 0 5px 15px rgba(5, 117, 230, 0.4);
    }

    .good {
      background: linear-gradient(135deg, #56ab2f, #a8e6cf);
      color: white;
      box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
    }

    .moderate {
      background: linear-gradient(135deg, #f7971e, #ffd200);
      color: white;
      box-shadow: 0 5px 15px rgba(247, 151, 30, 0.4);
    }

    .warning {
      background: linear-gradient(135deg, #ff6a00, #ee0979);
      color: white;
      box-shadow: 0 5px 15px rgba(255, 106, 0, 0.4);
    }

    .critical {
      background: linear-gradient(135deg, #dc2424, #4a569d);
      color: white;
      box-shadow: 0 5px 15px rgba(220, 36, 36, 0.4);
    }

    .section-title {
      text-align: center;
      font-size: 2em;
      color: white;
      margin: 40px 0 30px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .loading {
      text-align: center;
      color: white;
      font-size: 1.2em;
      margin: 50px 0;
    }

    .loading::after {
      content: '...';
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {
      0%, 20% { color: rgba(255,255,255,0.4); }
      40% { color: white; }
      100% { color: rgba(255,255,255,0.4); }
    }

    @media (max-width: 768px) {
      .sensors-grid {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .sensor-card {
        padding: 20px;
      }
      
      .sensor-value {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üå± Smart Irrigation Dashboard</h1>
      <div class="subtitle">Real-time Agricultural Monitoring System</div>
    </div>
    
    <div id="timestamp-display" class="timestamp-card">
      <h2>üìÖ Loading sensor data...</h2>
    </div>

    <div class="section-title">ü•ï Raspberry Pi Sensors</div>
    <div id="pi-sensors" class="sensors-grid loading">Loading Pi sensor data</div>

    <div class="section-title">üåæ Slave Device Sensors</div>
    <div id="slave-sensors" class="sensors-grid loading">Loading slave sensor data</div>
  </div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDLjlDnZg9d9sJ2lCLUKGJ3pqbI_FHOB1Y",
      authDomain: "rpi-to-esp.firebaseapp.com",
      databaseURL: "https://rpi-to-esp-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "rpi-to-esp",
      storageBucket: "rpi-to-esp.firebasestorage.app",
      messagingSenderId: "430584609743",
      appId: "1:430584609743:web:be81735fca8c403bcc30ba",
      measurementId: "G-QPHK5018E3"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const sensorRef = ref(db, "sensor_readings");

    // Sensor configurations with icons and classification logic
    const sensorConfig = {
      // Pi Sensors
      'BMP280_Pressure': {
        icon: 'üå™Ô∏è',
        title: 'Atmospheric Pressure',
        unit: 'hPa',
        classify: (value) => {
          if (value > 1030) return 'excellent';
          if (value > 1000) return 'good';
          if (value > 980) return 'moderate';
          return 'warning';
        }
      },
      'BMP280_Temp': {
        icon: 'üå°Ô∏è',
        title: 'BMP Temperature',
        unit: '¬∞C',
        classify: (value) => {
          if (value >= 20 && value <= 28) return 'excellent';
          if (value >= 15 && value <= 35) return 'good';
          if (value >= 10 && value <= 40) return 'moderate';
          if (value >= 5 && value <= 45) return 'warning';
          return 'critical';
        }
      },
      'DHT11_Humidity': {
        icon: 'üíß',
        title: 'Air Humidity',
        unit: '%',
        classify: (value) => {
          if (value >= 40 && value <= 60) return 'excellent';
          if (value >= 30 && value <= 70) return 'good';
          if (value >= 20 && value <= 80) return 'moderate';
          return 'warning';
        }
      },
      'DHT11_Temp': {
        icon: 'üå°Ô∏è',
        title: 'DHT Temperature',
        unit: '¬∞C',
        classify: (value) => {
          if (value >= 20 && value <= 28) return 'excellent';
          if (value >= 15 && value <= 35) return 'good';
          if (value >= 10 && value <= 40) return 'moderate';
          if (value >= 5 && value <= 45) return 'warning';
          return 'critical';
        }
      },
      'PT1000_Temp': {
        icon: 'üî•',
        title: 'PT1000 Temperature',
        unit: '¬∞C',
        classify: (value) => {
          if (value >= 20 && value <= 28) return 'excellent';
          if (value >= 15 && value <= 35) return 'good';
          if (value >= 10 && value <= 40) return 'moderate';
          if (value >= 5 && value <= 45) return 'warning';
          return 'critical';
        }
      },
      'Rain': {
        icon: 'üåßÔ∏è',
        title: 'Rain Detection',
        unit: '',
        classify: (value) => {
          // Assuming 0 = no rain, higher values = more rain
          if (value === 0) return 'excellent';
          if (value <= 10) return 'good';
          if (value <= 50) return 'moderate';
          return 'warning';
        }
      },
      'SM1': {
        icon: 'üå±',
        title: 'Soil Moisture 1',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';   // Very moist
          if (value < 1200) return 'good';       // Good moisture
          if (value < 2000) return 'moderate';   // Moderate
          if (value < 2500) return 'warning';    // Dry
          return 'critical';                     // Very dry
        }
      },
      'SM2': {
        icon: 'üåø',
        title: 'Soil Moisture 2',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';
          if (value < 1200) return 'good';
          if (value < 2000) return 'moderate';
          if (value < 2500) return 'warning';
          return 'critical';
        }
      },
      'WindSpeed': {
        icon: 'üí®',
        title: 'Wind Speed',
        unit: 'm/s',
        classify: (value) => {
          if (value <= 5) return 'excellent';    // Calm to light breeze
          if (value <= 15) return 'good';        // Moderate breeze
          if (value <= 25) return 'moderate';    // Strong breeze
          if (value <= 35) return 'warning';     // Gale
          return 'critical';                     // Storm
        }
      },
      // Slave Sensors
      'Soil1': {
        icon: 'üåæ',
        title: 'Field Soil 1',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';
          if (value < 1200) return 'good';
          if (value < 2000) return 'moderate';
          if (value < 2500) return 'warning';
          return 'critical';
        }
      },
      'Soil2': {
        icon: 'üåΩ',
        title: 'Field Soil 2',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';
          if (value < 1200) return 'good';
          if (value < 2000) return 'moderate';
          if (value < 2500) return 'warning';
          return 'critical';
        }
      },
      'Soil3': {
        icon: 'ü•¨',
        title: 'Field Soil 3',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';
          if (value < 1200) return 'good';
          if (value < 2000) return 'moderate';
          if (value < 2500) return 'warning';
          return 'critical';
        }
      },
      'Soil4': {
        icon: 'ü•ï',
        title: 'Field Soil 4',
        unit: '',
        classify: (value) => {
          if (value < 800) return 'excellent';
          if (value < 1200) return 'good';
          if (value < 2000) return 'moderate';
          if (value < 2500) return 'warning';
          return 'critical';
        }
      },
      'Temp1': {
        icon: 'üå°Ô∏è',
        title: 'Field Temperature 1',
        unit: '¬∞C',
        classify: (value) => {
          if (value >= 20 && value <= 28) return 'excellent';
          if (value >= 15 && value <= 35) return 'good';
          if (value >= 10 && value <= 40) return 'moderate';
          if (value >= 5 && value <= 45) return 'warning';
          return 'critical';
        }
      },
      'Temp2': {
        icon: 'üå°Ô∏è',
        title: 'Field Temperature 2',
        unit: '¬∞C',
        classify: (value) => {
          if (value >= 20 && value <= 28) return 'excellent';
          if (value >= 15 && value <= 35) return 'good';
          if (value >= 10 && value <= 40) return 'moderate';
          if (value >= 5 && value <= 45) return 'warning';
          return 'critical';
        }
      }
    };

    function createSensorCard(key, value, config) {
      const classification = config.classify(value);
      return `
        <div class="sensor-card">
          <div class="sensor-header">
            <div class="sensor-icon">${config.icon}</div>
            <div class="sensor-title">${config.title}</div>
          </div>
          <div class="sensor-value ${classification}">
            ${value} <span class="sensor-unit">${config.unit}</span>
          </div>
        </div>
      `;
    }

    // Listen for updates
    onValue(sensorRef, (snapshot) => {
      const data = snapshot.val();
      if (!data) return;

      // Get latest entry
      const keys = Object.keys(data);
      const latestKey = keys[keys.length - 1];
      const latestData = data[latestKey];

      const sensors = latestData.PiSensors || {};
      const slave = latestData.Slave || {};
      const timestamp = latestData.timestamp || "";

      // Update timestamp
      document.getElementById("timestamp-display").innerHTML = `
        <h2>üìÖ Last Updated: ${timestamp}</h2>
        <div>System Status: <span style="color: #00f260;">‚óè Online</span></div>
      `;

      // Pi Sensors
      const piSensorKeys = ['BMP280_Pressure', 'BMP280_Temp', 'DHT11_Humidity', 'DHT11_Temp', 'PT1000_Temp', 'Rain', 'SM1', 'SM2', 'WindSpeed'];
      const piSensorsHTML = piSensorKeys.map(key => {
        let value = sensors[key];
        if (['SM1', 'SM2'].includes(key) && typeof value === 'number') {
          value = value;
        }
        const config = sensorConfig[key];
        return config ? createSensorCard(key, value, config) : '';
      }).join('');

      document.getElementById("pi-sensors").innerHTML = piSensorsHTML || '<div class="loading">No Pi sensor data available</div>';

      const slaveSensorKeys = ['Soil1', 'Soil2', 'Soil3', 'Soil4', 'Temp1', 'Temp2'];
      const slaveSensorsHTML = slaveSensorKeys.map(key => {
        let value = slave[key];
        if (['Soil1', 'Soil2', 'Soil3', 'Soil4'].includes(key)) {
          value = calibrateSoilReading(Number(value));
        }
        const config = sensorConfig[key];
        return config ? createSensorCard(key, value, config) : '';
      }).join('');

      document.getElementById("slave-sensors").innerHTML = slaveSensorsHTML || '<div class="loading">No slave sensor data available</div>';
    });
  </script>
</body>
</html>


